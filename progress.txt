## Stories Feature Progress

### Module 1: Story storage ✅
- Added `Story` interface to `lib/types.ts` (id, title, description, tags, createdAt, updatedAt)
- Added `stories` storage key and CRUD functions to `lib/storage.ts` (getStories, addStory, updateStory, deleteStory)

### Module 2: Stories management page ✅
- Created `entrypoints/sidepanel/pages/Stories.tsx` — full CRUD UI
  - Scrollable list of stories with titles and tags
  - Expandable stories (click chevron to reveal description)
  - Inline editing (title, description, tags)
  - Add story form with title, description, and comma-separated tags
  - Delete with confirmation step
  - Empty state when no stories exist
  - Story count footer
- Added `"stories"` to Page type in `App.tsx`, wired navigation (Settings → Stories → back to Settings)
- Added "Manage Stories" button in `SettingsModal.tsx` (before Save button)

### Module 3: AI Enhance function ✅
- Added `buildStoryEnhancePrompt` to `lib/prompts.ts` — takes rough notes + title, returns JSON `{ description, tags }`
- Uses `xmlSections` helper consistent with other prompt builders
- Added `handleEnhance` helper in `Stories.tsx` — calls `chatCompletion` with user's API key and model
- Wired "Enhance" button into the add-story form (enhances description + auto-fills tags)
- Wired "Enhance" button into the inline edit form (same behavior)
- Loading states: `enhancingNew` for add form, `enhancingId` for edit form
- User can review and edit AI output before saving
### Module 4: Relevance filter ✅
- Added `StorySelection` interface to `lib/types.ts` (id, reason)
- Added `buildStoryRelevancePrompt` to `lib/prompts.ts` — takes story summaries (id + title + tags) and job description, returns JSON array of selections with reasons
- Created `lib/stories.ts` with `filterRelevantStories` function — sends only titles/tags to keep the call cheap, validates returned IDs against input stories
- Uses `chatCompletion` (non-streaming) with the user's selected model
### Module 5: Inline confirmation component ✅
- Created `entrypoints/sidepanel/components/StoryConfirmation.tsx`
  - Shows AI-picked stories as pre-checked checkboxes with relevance reasons
  - Shows remaining stories as unchecked checkboxes for manual addition
  - "Confirm & Generate" and "Cancel" buttons
  - Displays count of selected stories in header
- Integrated into `Selector.tsx` generation flow:
  - After collecting inputs, fetches all stories and runs relevance filter
  - Pauses generation with a Promise-based confirmation UI
  - User confirms/modifies selections → generation proceeds with selected stories
  - Cancel returns to idle state
  - StatusBar hidden while confirmation is showing
### Module 6: Prompt modifications ✅
- Added `formatStories` helper in `lib/prompts.ts` — formats Story[] as XML with title, description, and tags per story
- Added optional `stories` parameter to `buildCvTailoringPrompt` — injects `<candidate_stories>` block, updated rules to reference stories as additional context
- Added optional `stories` parameter to `buildQuestionAnswerPrompt` — injects `<candidate_stories>` block, updated rules to draw on stories for answers
- Stories are placed before guidance/CV in the prompt so the model sees them as context before the main content
### Module 7: Generation flow update ✅
- Passed `selectedStories` to `buildCvTailoringPrompt` in the CV tailoring step so the AI references real experience when adapting the CV
- Passed `selectedStories` to `buildQuestionAnswerPrompt` in the question answering step so the AI draws on specific missions/projects when writing answers
- The full flow is now: collect inputs → filter relevant stories → show confirmation → inject confirmed stories into CV tailoring + question answering prompts

## All modules complete ✅
